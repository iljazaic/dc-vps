class FormRenderer{constructor(e,t){this.configUrl=e,this.container=document.getElementById(t),this.config=null,this.formData={}}async init(){try{const e=await fetch(this.configUrl);this.config=await e.json(),this.render()}catch(e){console.error("Error loading form config:",e)}}render(){if(!this.config)return;const e=this.config.form,t=document.createElement("div");t.className="form-container";const n=document.createElement("h1");n.textContent=e.title,n.className="form-title",t.appendChild(n);const a=document.createElement("div");a.className="tab-nav",e.tabs.forEach((e,t)=>{const n=document.createElement("button");n.className="tab-btn"+(0===t?" active":""),n.textContent=e.label,n.dataset.tabId=e.id,n.addEventListener("click",()=>this.switchTab(e.id)),a.appendChild(n)}),t.appendChild(a);const i=document.createElement("div");i.className="tab-content",e.tabs.forEach((e,t)=>{const n=document.createElement("div");if(n.className="tab-pane"+(0===t?" active":""),n.id="tab-"+e.id,e.sections&&e.sections.length>0)e.sections.forEach(e=>{const t=this.renderSection(e);n.appendChild(t)});else{const e=document.createElement("p");e.className="empty-tab",e.textContent="This section is empty",n.appendChild(e)}i.appendChild(n)}),t.appendChild(i);const l=document.createElement("div");l.className="form-actions";const d=document.createElement("button");d.type="button",d.className="btn btn-primary",d.textContent="Reserve and Pay",d.addEventListener("click",()=>this.handleSubmit()),l.appendChild(d);const c=document.createElement("button");c.type="button",c.className="btn btn-secondary",c.textContent="Reset",c.addEventListener("click",()=>this.handleReset()),l.appendChild(c),t.appendChild(l),this.container.appendChild(t)}renderSection(e){const t=document.createElement("div");t.className="form-section";const n=document.createElement("h2");n.className="section-title",n.textContent=e.title,t.appendChild(n);const a=document.createElement("div");return a.className="form-fields",e.fields.forEach(e=>{const t=this.renderField(e);a.appendChild(t)}),t.appendChild(a),t}async verifySubdomainAvailability(){const e=document.querySelector("#verifyDomainButton");let t=document.querySelector("#subdval");if(null!=t&&null!=t){const n=t.value;try{const t=await fetch(`/domain-available?d=${encodeURIComponent(n)}`),a=await t.json();e.style.backgroundColor=1==a.available?"green":"red"}catch(t){return e.style.backgroundColor="red",e.innerText="ERR",!1}}}renderField(e){const t=document.createElement("div");t.className="checkbox"==e.type?"form-field flex-row":"form-field";const n=document.createElement("label");let a,i;switch(n.htmlFor=e.id,n.className="field-label",n.textContent=e.label,e.type){case"table":i=document.createElement("table"),i.id=e.id,i.className="field-input table";for(let t=0;t<e.rows;t++){let n=document.createElement("tr");i.appendChild(n);for(let a=0;a<e.cols;a++){let i=document.createElement("td");if(n.appendChild(i),0==t)switch(a){case 0:i.innerText="VM internal port",i.className+=" portspan";break;case 1:i.innerText="Subdomain (genereated)",i.className+=" portspan"}else if("porttable"==e.id)if(0==a){let e=document.createElement("input");e.className="field-input",i.appendChild(e)}else i.innerText=1==a?"xxxx.dc-vps.com":"",i.className+=" portspan"}}break;default:a=document.createElement("input"),a.id=e.id,a.className="field-input",a.type=e.type;break;case"subdomain":i=document.createElement("table"),i.id=e.id,i.className="field-input table";let l=document.createElement("tr");i.appendChild(l);let d=document.createElement("td"),c=document.createElement("input");c.className="field-input",c.type="text",c.id="subdval",d.appendChild(c);let o=document.createElement("td");o.innerText=".dc-vps.com",o.style.textAlign="left",c.style.left="30%",l.appendChild(d),l.appendChild(o);let s=document.createElement("td");s.innerText="Check availability:  ";let r=document.createElement("button");r.className="verifysubdomain",r.innerText="?",r.onclick=this.verifySubdomainAvailability,r.id="verifyDomainButton",s.appendChild(r),l.appendChild(s);break;case"file":a=document.createElement("input"),a.id=e.id,a.className="field-input file",a.type="file",a.setAttribute("accept",e.accept),1!=e.enabled&&a.setAttribute("disabled","");break;case"select":a=document.createElement("select"),a.id=e.id,a.className="field-input",null!=e.enabled&&0==e.enabled&&a.setAttribute("disabled",""),e.options.forEach(t=>{const n=document.createElement("option");n.value=t.value,n.textContent=t.label,n.selected=t.value===(e.default||""),a.appendChild(n)}),this.formData[e.id]=e.default||e.options[0].value;break;case"slider":const m=document.createElement("div");m.className="slider-container",a=document.createElement("input"),a.type="range",a.id=e.id,a.className="field-input slider",a.min=e.min,a.max=e.max,a.step=e.step,a.value=e.default||e.min;const u=document.createElement("span");return u.className="slider-value",u.textContent=this.config.form.prices[e.id][e.default]+e.unit,a.addEventListener("input",t=>{console.log(this.config.form.prices),u.textContent=this.config.form.prices[e.id][t.target.value]+e.unit,this.formData[e.id]=parseInt(t.target.value)}),this.formData[e.id]=e.default||e.min,m.appendChild(a),m.appendChild(u),t.appendChild(n),t.appendChild(m),t;case"checkbox":return a=document.createElement("input"),a.type="checkbox",a.id=e.id,a.className="field-input",a.checked=e.default||!1,this.formData[e.id]=e.default||!1,a.addEventListener("change",t=>{this.formData[e.id]=t.target.checked,null!=e.enable_option&&(1==t.target.checked?document.querySelector("#"+e.enable_option).removeAttribute("disabled"):document.querySelector("#"+e.enable_option).setAttribute("disabled",""))}),t.appendChild(a),t.appendChild(n),t;case"number":a=document.createElement("input"),a.type="number",a.id=e.id,a.className="field-input",a.min=e.min,a.max=e.max,a.value=e.default||e.min,this.formData[e.id]=e.default||e.min,a.addEventListener("change",t=>{this.formData[e.id]=parseInt(t.target.value)})}return"slider"!==e.type&&(t.appendChild(n),null!=a&&t.appendChild(a),null!=i&&t.appendChild(i)),t}switchTab(e){document.querySelectorAll(".tab-pane").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".tab-btn").forEach(e=>{e.classList.remove("active")}),document.getElementById("tab-"+e).classList.add("active"),document.querySelector(`[data-tab-id="${e}"]`).classList.add("active")}handleSubmit(){console.log("Form submitted with data:",this.formData),alert("Configuration submitted:\n"+JSON.stringify(this.formData,null,2))}handleReset(){document.querySelectorAll(".field-input").forEach(e=>{"checkbox"===e.type?e.checked=!1:"range"===e.type?(e.value=e.default,e.nextElementSibling.textContent=e.value):e.value=e.options?e.options[0].value:""}),this.formData={}}}document.addEventListener("DOMContentLoaded",()=>{new FormRenderer("./conf/form-config.json","form-container").init()});