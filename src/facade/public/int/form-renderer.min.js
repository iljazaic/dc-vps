class FormRenderer{constructor(e,t){this.configUrl=e,this.container=document.getElementById(t),this.config=null,this.formData={},this.tprice=0}async init(){try{const e=await fetch(this.configUrl);this.config=await e.json(),this.render()}catch(e){console.error("Error loading form config:",e)}}render(){if(!this.config)return;const e=this.config.form,t=document.createElement("div");t.className="form-container";const n=document.createElement("h1");n.textContent=e.title,n.className="form-title",t.appendChild(n);const a=document.createElement("div");a.className="tab-nav",e.tabs.forEach((e,t)=>{const n=document.createElement("button");n.className="tab-btn"+(0===t?" active":""),n.textContent=e.label,n.dataset.tabId=e.id,n.addEventListener("click",()=>this.switchTab(e.id)),a.appendChild(n)}),t.appendChild(a);const i=document.createElement("div");i.className="tab-content",e.tabs.forEach((e,t)=>{const n=document.createElement("div");if(n.className="tab-pane"+(0===t?" active":""),n.id="tab-"+e.id,e.sections&&e.sections.length>0)e.sections.forEach(t=>{const a=this.renderSection(t);if("specs"==e.id&&0==e.sections.indexOf(t)){const e=document.createElement("h2");e.textContent=`Monthly Price: ${this.tprice} kr`,e.className="price-label",e.id="price",a.appendChild(e)}n.appendChild(a)});else{const e=document.createElement("p");e.className="empty-tab",e.textContent="This section is empty",n.appendChild(e)}i.appendChild(n)}),t.appendChild(i);const l=document.createElement("div");l.className="form-actions";const c=document.createElement("button");c.type="button",c.className="btn btn-primary",c.textContent="Reserve and Pay",c.addEventListener("click",()=>this.handleSubmit()),l.appendChild(c);const o=document.createElement("button");o.type="button",o.className="btn btn-secondary",o.textContent="Reset",o.addEventListener("click",()=>this.handleReset()),l.appendChild(o),t.appendChild(l),this.container.appendChild(t),this.tprice+=this.config.form.prices.ram[document.querySelector("#ram").value],this.tprice+=this.config.form.prices.storage[document.querySelector("#storage").value],this.tprice+=this.config.form.prices.vcpu[document.querySelector("#vcpu").value],document.querySelector("#price").innerText=`Monthly Price: ${this.tprice} kr`}renderSection(e){const t=document.createElement("div");t.className="form-section";const n=document.createElement("h2");n.className="section-title",n.textContent=e.title,t.appendChild(n);const a=document.createElement("div");return a.className="form-fields",e.fields.forEach(e=>{const t=this.renderField(e);a.appendChild(t)}),t.appendChild(a),t}async verifySubdomainAvailability(){const e=document.querySelector("#verifyDomainButton");let t=document.querySelector("#subdval");if(null!=t&&null!=t){const n=t.value;try{const t=await fetch(`/domain-available?d=${encodeURIComponent(n)}`),a=await t.json();e.style.backgroundColor=1==a.available?"green":"red",a.available&&(this.formData.subd=n)}catch(t){return console.log(t),console.log(this.formData),e.style.backgroundColor="red",e.innerText="ERR",!1}}}renderField(e){console.log(this.formData);const t=document.createElement("div");t.className="checkbox"==e.type?"form-field flex-row":"form-field";const n=document.createElement("label");let a,i;switch(n.htmlFor=e.id,n.className="field-label",n.textContent=e.label,e.type){case"table":i=document.createElement("table"),i.id=e.id,i.className="field-input table";for(let t=0;t<e.rows;t++){let n=document.createElement("tr");i.appendChild(n);for(let a=0;a<e.cols;a++){let i=document.createElement("td");if(n.appendChild(i),0==t)switch(a){case 0:i.innerText="VM internal port",i.className+=" portspan";break;case 1:i.innerText="Subdomain (genereated)",i.className+=" portspan"}else if("porttable"==e.id)if(0==a){let t=document.createElement("input");t.className="field-input portin",t.addEventListener("input",t=>{var n=[...document.querySelectorAll(".portin")];this.formData[e.id]="",n.forEach(t=>{""!=t.value&&(this.formData[e.id]+=t.value+"|")})}),i.appendChild(t)}else i.innerText=1==a?"xxxx.dc-vps.com":"",i.className+=" portspan"}}this.formData[e.id]="";break;default:a=document.createElement("input"),a.id=e.id,a.className="field-input",a.type=e.type;break;case"subdomain":i=document.createElement("table"),i.id=e.id,i.className="field-input table";let l=document.createElement("tr");i.appendChild(l);let c=document.createElement("td"),o=document.createElement("input");o.className="field-input",o.type="text",o.id="subdval",c.appendChild(o);let d=document.createElement("td");d.innerText=".dc-vps.com",d.style.textAlign="left",o.style.left="30%",l.appendChild(c),l.appendChild(d);let r=document.createElement("td");r.innerText="Check availability:  ";let s=document.createElement("button");s.className="verifysubdomain",s.innerText="?",o.addEventListener("input",t=>{this.formData[e.id]="",s.style.backgroundColor="white"}),s.onclick=()=>this.verifySubdomainAvailability(),s.id="verifyDomainButton",r.appendChild(s),l.appendChild(r),this.formData[e.id]="";break;case"file":a=document.createElement("input"),a.id=e.id,a.className="field-input file",a.type="file",a.setAttribute("accept",e.accept),1!=e.enabled&&a.setAttribute("disabled","");break;case"select":a=document.createElement("select"),a.id=e.id,a.className="field-input",null!=e.enabled&&0==e.enabled&&a.setAttribute("disabled",""),e.options.forEach(t=>{const n=document.createElement("option");n.value=t.value,n.textContent=t.label,n.selected=t.value===(e.default||""),a.appendChild(n)}),this.formData[e.id]=e.default||e.options[0].value;break;case"slider":const m=document.createElement("div");m.className="slider-container",a=document.createElement("input"),a.type="range",a.id=e.id,a.className="field-input slider",a.min=e.min,a.max=e.max,a.step=e.step,a.value=e.default||e.min;const u=document.createElement("span");return u.className="slider-value",u.textContent=this.config.form.values[e.id][e.default]+e.unit,a.addEventListener("input",t=>{console.log(this.config.form.values),u.textContent=this.config.form.values[e.id][t.target.value]+e.unit,this.formData[e.id]=parseInt(t.target.value);let n=this.config.form.prices.ram[document.querySelector("#ram").value];n+=this.config.form.prices.storage[document.querySelector("#storage").value],n+=this.config.form.prices.vcpu[document.querySelector("#vcpu").value],this.tprice=n,document.querySelector("#price").innerText=`Monthly Price: ${n} kr`}),this.formData[e.id]=e.default||e.min,m.appendChild(a),m.appendChild(u),t.appendChild(n),t.appendChild(m),t;case"checkbox":return a=document.createElement("input"),a.type="checkbox",a.id=e.id,a.className="field-input",a.checked=e.default||!1,this.formData[e.id]=e.default||!1,a.addEventListener("change",t=>{this.formData[e.id]=t.target.checked,null!=e.enable_option&&(1==t.target.checked?document.querySelector("#"+e.enable_option).removeAttribute("disabled"):document.querySelector("#"+e.enable_option).setAttribute("disabled",""))}),t.appendChild(a),t.appendChild(n),t;case"number":a=document.createElement("input"),a.type="number",a.id=e.id,a.className="field-input",a.min=e.min,a.max=e.max,a.value=e.default||e.min,this.formData[e.id]=e.default||e.min,a.addEventListener("change",t=>{this.formData[e.id]=parseInt(t.target.value)})}return"slider"!==e.type&&(t.appendChild(n),null!=a&&t.appendChild(a),null!=i&&t.appendChild(i)),t}switchTab(e){document.querySelectorAll(".tab-pane").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".tab-btn").forEach(e=>{e.classList.remove("active")}),document.getElementById("tab-"+e).classList.add("active"),document.querySelector(`[data-tab-id="${e}"]`).classList.add("active")}handleSubmit(){console.log("Form submitted with data:",this.formData),alert("Configuration submitted:\n"+JSON.stringify(this.formData,null,2))}handleReset(){document.querySelectorAll(".field-input").forEach(e=>{"checkbox"===e.type?e.checked=!1:"range"===e.type?(e.value=e.default,e.nextElementSibling.textContent=e.value):e.value=e.options?e.options[0].value:""}),this.formData={}}}document.addEventListener("DOMContentLoaded",()=>{new FormRenderer("./conf/form-config.json","form-container").init()});